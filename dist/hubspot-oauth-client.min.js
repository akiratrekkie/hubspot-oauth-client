!function(){"use strict";function t(){var t,n,i=arguments[0];for(n=1;n<arguments.length;n++)for(t in arguments[n])arguments[n].hasOwnProperty(t)&&(i[t]=arguments[n][t]);return i}function n(t){return Object.prototype.toString.apply(t)}function i(t){return"number"==typeof t&&!isNaN(t)}function o(t){return"string"==typeof t}function e(n){if(!this.constructor.Promise)throw new Error("Missing Promise implementation. Please setup HubSpotOAuthClient.Promise");this.config=t({},this.constructor.DEFAULT_CONFIG,n),this.constructor.validateConfiguration(this.config),this.callbacks={oAuthSuccess:[],oAuthError:[]}}var r,s,u=window;e.UUID_REGEXP=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/,e.SCOPES={},e.SCOPES.OFFLINE="offline",e.SCOPES.CONTACTS_READ_ONLY="contacts-ro",e.SCOPES.CONTACTS_READ_WRITE="contacts-rw",e.SCOPES.BLOG_READ_WRITE="blog-rw",e.SCOPES.EVENTS_READ_WRITE="events-rw",e.SCOPES.KEYWORD_READ_WRITE="keyword-rw",s=[e.SCOPES.OFFLINE,e.SCOPES.CONTACTS_READ_ONLY,e.SCOPES.CONTACTS_READ_WRITE,e.SCOPES.BLOG_READ_WRITE,e.SCOPES.EVENTS_READ_WRITE,e.SCOPES.KEYWORD_READ_WRITE],e.DEFAULT_CONFIG={oAuthURI:"https://app.hubspot.com/auth/authenticate/",windowTitle:"Integrate with HubSpot",windowWidth:600,windowHeight:400,cancelCheckDelay:100},e.CONFIG_VALIDATORS={oAuthURI:o,clientId:function(t){return e.UUID_REGEXP.test(t)},applicationId:function(t){return i(t)},applicationScope:function(t){return"[object Array]"===n(t)&&t.length>0&&t.every(function(t){return-1!==s.indexOf(t)})},redirectURI:o,windowTitle:function(t){return"string"==typeof t},windowHeight:function(t){return i(t)},windowWidth:function(t){return i(t)},cancelCheckDelay:function(t){return i(t)}},e.Promise=u.Promise,e.validateConfiguration=function(t){Object.keys(t).forEach(function(t){if(!(t in e.CONFIG_VALIDATORS))throw new Error('Unknown config parameter "'+t+'"')}),Object.keys(e.CONFIG_VALIDATORS).forEach(function(n){if(!(n in t))throw new Error('Missing parameter "'+n+'" from config');var i=t[n];if(!e.CONFIG_VALIDATORS[n](i))throw new Error('Parameter "'+n+'" in config is invalid: "'+i+'"')})},e.isHubIdValid=function(t){var n=Number(t);return!isNaN(n)&&n>0},r=e.prototype,r._setHubId=function(t){if(!this.constructor.isHubIdValid(t))throw new Error('Invalid HubSpot id "'+t+'"');if(this._getPromiseWindow().isOpen())throw new this.constructor.PendingIntegrationError('Cannot set Hub ID to "". A OAuth integration is pending');this.hubId=Number(t)},r._getIntegrationURI=function(){return this.constructor.BASE_URL+"?"+["client_id="+u.encodeURIComponent(this.config.clientId),"portalId="+u.encodeURIComponent(this.hubId),"redirect_uri="+u.encodeURIComponent(this.config.redirectURI+(-1===this.config.redirectURI.indexOf("?")?"?":"&")+["hubId="+this.hubId].join("&"))].join("&")},r._getPromiseWindow=function(){return this._promiseWindow?this._promiseWindow.setURI(this._getIntegrationURI()):this._promiseWindow=new PromiseWindow(this._getIntegrationURI(),t({},this._config,{onPostMessage:function(t){"hubId"in t.data&&(t.data.hubId=Number(t.data.hubId)),PromiseWindow.defaultConfig.onPostMessage.call(this,t)}})),this._promiseWindow},r.initiateIntegration=function(t){if(0===arguments.length)throw new Error("Missing Hub ID");return this._setHubId(t),this._getPromiseWindow().open()},u.HubSpotOAuthClient=e}();